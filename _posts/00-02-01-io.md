---
layout: post
title: Callbacks &amp; I/O
class: io
date: 2014-05-19 00:00:00
---

Today we'll start with callbacks and then move on to working with files and
user input. This will allow us to start building more complex applications.

## Callbacks

For now let's think of callbacks as a way of letting you know that something
has completed. We'll get to a more technical definition momentarily.

Let's use an example to illustrate the point. We'll try to write some
code for baking a cake. Here's a starting place.

{% highlight javascript %}
// prep work
preheatOven('350deg');

// make the cake batter
var batter = mix(['flour', 'eggs', 'butter']);
var pan = {
  type: 'pan',
  diameter: '9in',
  shape: 'round'
};
var cake = pour(pan, batter);

// bake the cake
ovenAddItem(cake);
ovenSetTimer('30min');
ovenRemoveItem(cake);

// frost the cake
var frosting = mix(['sugar', 'butter']);
decorate(cake, frosting);
{% endhighlight %}

As it stands, this code won't allow us to accomplish our goal of baking a cake
the way people usually do it. Let's implement some of these functions to get
and idea of why this is.

### Result

We needed to use callbacks to properly write this code. The resulting code
becomes:

{% highlight javascript %}
// prep work
preheatOven('350deg');

// make the cake batter
var batter = mix(['flour', 'eggs', 'butter']);
var pan = {
  type: 'pan',
  diameter: '9in',
  shape: 'round'
};
var cake = pour(pan, batter);
var frosting = null;

// bake the cake
ovenAddItem(cake);
ovenSetTimer('30min', function() {
  ovenRemoveItem(cake);
  decorate(cake, frosting);
});

// frost the cake
frosting =  mix(['sugar', 'butter', 'cocoa powder']);
{% endhighlight %}


A _callback_ is the generic term for a function that's passed as an argument
to another function, usually a long running operation. The callback function
will be called once the long running operation completes.

### Test Driven Development

Mocha is designed to work well out of the box with _asynchronous_, or callback
based functions. Every time you write a test with `it`, you can provide an
additional argument to your function, usually called `done`. `done` is a
function that you should call once everything has been completed. That means
you can call it from your callback.

Let's clear out the definition of `ovenSetTimer` and write a few tests, make
sure that they fail, and work out the definition of `ovenSetTimer` again.

{% highlight javascript %}
describe('ovenSetTimer()', function() {
  it('calls the callback', function(done) {
    ovenSetTimer('0s', done);
  });
});
{% endhighlight %}


### Challenges

Don't forget to use Git and TDD.

- Write a function, `setReminder(date, callback)` that will execute the
  callback at the given time. You'll need [`setTimeout`][node-settimeout] and
  [dates][mdn-dates]. There's also an
  [MDN page on `setTimeout`][mdn-settimeout].
- Create a stopwatch that counts to `10` using `setTimeout`.
- Create a stopwatch that counts to `10` using `setReminder`.
- Use [Lo-Dash][lodash], specifically [`_.range`][lodash-range] and
  [`_.forEach`][lodash-foreach] to create a stopwatch that counts to `10`.
  Try implementing this with both `setTimeout` directly and also with your
  `setReminder` function.
- **Advanced:** Make `setReminder` use strings instead of a date object, so
  you can type `tomorrow at 3pm` or `noon`. This is called _natural language
  processing_. _Natural language processing_ is incredibly, incredibly
  difficult to implement.


## I/O

### Jargon

I/O is short for Input/output. This has meanings in both
computer hardware and software. I/O in software generally refers to
communication with hardware devices, mice, keyboards, monitors, hard drives,
etc.

<aside>
Accessing files via the _file system_ is one form of I/O. Because accessing
files is probably the most common form of I/O, you will hear the term I/O used
when someone is just referring to work they're doing with files.
</aside>

### Speed

I/O is slow. It may not feel that way to you, but to a computer it's _orders of
magnitude_ slower than the code you've written so far. The difference is about
the same as the difference between the speed at which a baby crawls and the
speed of a fighter jet.

What does this mean to you?

It means we shouldn't wait for the I/O. We should continue doing whatever we
can while I/O happens.


[node-readfile]: http://nodejs.org/api/fs.html#fs_fs_readfile_filename_options_callback
[node-settimeout]: http://nodejs.org/api/timers.html#timers_settimeout_callback_delay_arg
[mdn-dates]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date
[mdn-settimeout]: https://developer.mozilla.org/en-US/docs/Web/API/Window.setTimeout

[lodash]: http://lodash.com
[lodash-range]: http://lodash.com/docs#range
[lodash-foreach]: http://lodash.com/docs#forEach
